<!DOCTYPE html>

<head>
	<html lang="pl">
	<meta charset="utf-8" />
	<link href="https://fonts.googleapis.com/css?family=Roboto+Slab" rel="stylesheet">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<link type="text/css" rel="stylesheet" href="style.css">
	<title>Profile Page</title>
</head>
<body>
<div class="header"><img style="display:block; transform:translate(5px, 5px); width:60px; height:60px;  border-radius:40px;" src="img/lo.jpg"/></div>
	<div class="centered">
		<h2>Edit Your Profile</h2>

		<div id="profile-container" class="tile" >
		<div class="section"><form>
		<table><tr><h3>Edit your name:</h3></tr>
			<tr><td>First Name: </td><td><input id="name"/><br></td></tr>
			<tr><td>Second Name: </td><td><input id="name2"/><br></td></tr>
			<tr><td></td><td><input type="button" value="Save"></td></tr>
		</table></form>
		</div>
		<div class="section"><form>
		<table><tr><h3>Edit your password:</h3></tr>
			<tr><td>Current password: </td><td><input id="oldPass"/><br></td></tr>
			<tr><td>New password: </td><td><input id="newPass"/><br></td></tr>
			<tr><td>Repeat new password: </td><td><input id="newPassRepeat"/><br></td></tr>
			<tr><td></td><td><input type="button" value="Save"></td></tr>
		</table></form>
		</div>
		<div class="section"><form>
		<table><tr><h3>Edit your birth date:</h3></tr>
			<tr><td>Birth Date: </td><td><input id="dateofbirth"/><br></td></tr>
			<tr><td></td><td><input type="button" value="Save"></td></tr>
		</table></form>
		</div>
		<div class="section"><form>
		<table><tr><h3>Edit your address:</h3></tr>
			<tr><td>Adress: </td><td><input id="address"/><br></td></tr>
			<tr><td>Post-code and City :</td><td><input id="address2"/><br></td></tr>
			<tr><td>Country: </td><td><input id="country"/><br></td></tr>
			<tr><td></td><td><input type="button" value="Save"></td></tr>
		</table></form>
		</div>

		<div class="section"><form id="jobexperienceform">
			<table><tr><h3>Add job experience:</h3></tr>
				<tr><td>Company name: </td><td><input name="company" id="companyName"/><br></td></tr>
				<tr><td>From date (dd-mm-yyyy):</td><td><input name="from" id="companyFrom"/><br></td></tr>
				<tr><td>To date (dd-mm-yyyy): </td><td><input name="to" id="companyTo"/><br></td></tr>
				<tr><td></td><td><input type="button" onclick="addObjectToArray('jobexperienceform',jsonProfile.jobexperience, 'jobexperiencelist')" value="+ Add"></td></tr>
			</table></form>
			<div id="jobexperiencelist" data-json="jobexperience"></div>
		</div>

			<div class="section"><form id="schoolsform">
				<table><tr><h3>Add finished school:</h3></tr>
					<tr><td>School name: </td><td><input name="name" id="schoolName"/><br></td></tr>
					<tr><td>From date (dd-mm-yyyy):</td><td><input name="from" id="schoolFrom"/><br></td></tr>
					<tr><td>To date (dd-mm-yyyy): </td><td><input name="to" id="schoolTo"/><br></td></tr>
					<tr><td></td><td><input type="button" onclick="addObjectToArray('schoolsform',jsonProfile.schools, 'schoolslist')" value="+ Add"></td></tr>
				</table></form>
				<div id="schoolslist" data-json="schools"></div>
			</div>

			<!--<div class="section"><form id="jobexperienceform">-->
				<!--<table><tr><h3>Add job experience:</h3></tr>-->
					<!--<tr><td>Company name: </td><td><input name="company" id="companyName"/><br></td></tr>-->
					<!--<tr><td>From date (dd-mm-yyyy):</td><td><input name="from" id="companyFrom"/><br></td></tr>-->
					<!--<tr><td>To date (dd-mm-yyyy): </td><td><input name="to" id="companyTo"/><br></td></tr>-->
					<!--<tr><td></td><td><input type="button" onclick="addObjectToArray('jobexperienceform',jsonProfile.jobexperience, 'jobexperiencelist')" value="+ Add"></td></tr>-->
				<!--</table></form>-->
				<!--<div id="jobexperiencelist" data-json="jobexperience"></div>-->
			<!--</div>-->
		<!--
		<div class="section"><form>
		<table>
			<tr><td>First Name: </td><td><input id="name"/><br></td></tr>
			<tr><td>Second Name: </td><td><input id="name2"/><br></td></tr>
			<tr><td></td><td><input type="submit"></td></tr>
		</table></form>
		</div>
			<tr><td>Age: </td><td><input id="age"/><br></td></tr>
			<tr><td>Tel: </td><td><input id="tel"/><br></td></tr>
			<tr><td>Address: </td><td><input id="address"/><br></td></tr>
			<tr><td>Job Experience: </td><td><input id="jobexperience"/><br></td></tr>
			<tr><td>Schools: </td><td><input id="schools"/><br></td></tr>
			<tr><td>Skills: </td><td><input id="skills"/><br></td></tr>
			<tr><td>Intrests: </td><td><input id="intrests"/><br></td></tr>
			<tr><td>Languages: </td><td><input id="languages" disabled/><br></td></tr>
			<tr><input id="saveBtn" type="button" value="Save"/></td></tr>
		</table>-->
		</div>
		
		</form>
	</div>
	
	<div class="footer"></div>
</body>
<script>
    //TODO: Group this code with other code, For now it is here for clarity purposes
    //List capability script
    //TMP command: $("<div>").html( $("<div>").html("hehe") ).appendTo(".objectInArray")

    var jsonProfile = {
        "uid":2,
        "name": "Krzysztof",
        "name2": "Widacki",
        "dateofbirth": "19-04-1998",
        "birthofaccount":"21-04-1998",
        "email": "krzysztofwidacki@gmail.com",
        "tel": "123456789",
        "address": "Słoneczna 15",
        "address2": "Warsaw 02-540",
        "country":"Poland",
        "jobexperience": [
            {"company":"Acaisoft",
                "from":"12-12-2017",
                "to":"1-1-2018"
            },
            {"company":"Google",
                "from":"12-12-2017",
                "to":"1-1-2018"
            },
            {"company":"Microsoft",
                "from":"12-12-2017",
                "to":"1-1-2018"
            }
        ],
        "schools": [
            {"name":"Wiśniowa",
                "from":"1-12-1212",
                "to":"2-12-1212"},
            {"name":"Staffa nr 1",
                "from":"1-12-1212",
                "to":"2-12-1212"},
            {"name":"Generic School 3",
                "from":"2-11-1318",
                "to":"2-1-1290"}
        ],
        "skills": [
            "breathing", "holding two handed swords with one hand"
        ],
        "acomplishments":{
            "interests": [
                "Films", "Bikes"
            ],
            "projects":[
                {
                    "name":"google self driving cars",
                    "ended":"1-1-2012"
                },
                {
                    "name":"cloudlanes",
                    "ended":"3-2-2013"
                }
            ],
            "courses":[
                {
                    "name":"ccna1course",
                    "ended":"1-1-2017"
                },
                {
                    "name":"ccna2course",
                    "ended":"2-2-2017"
                }
            ],
            "certificates":[
                {
                    "name":"ccna1",
                    "expirationDate":"1-1-2017"
                },
                {
                    "name":"ccna2",
                    "expirationDate":"2-2-2017"
                }
            ],
            "languages": [{
                "language": "english",
                "proficiency": "master"
            },
                {
                    "language": "german",
                    "proficiency": "beginner"
                }
            ]
        },
        "friends":[{
            "uid":1,
            "name": "Paweł",
            "name2": "Kłos"
        },
            {
                "uid":3,
                "name": "Wojciech",
                "name2": "Cejerowski"
            }]
    };

    function addObjectToArray(form, category, listToAppend){
        var fields = {};
        $("#"+form).find("input:not([type=button])").each(function() {
            fields[this.name] = $(this).val();
        });
        category.unshift(fields);
        updateObjectsInArray(category, listToAppend);
    }
    function updateObjectsInArray(category, listToAppend){
        //iterate different objects in array of f.e jobexperience
        var obj;
        var line;
        var key;
        var value;
        $("#"+listToAppend).empty();
        for(var i = 0 ; i < category.length ; i++){
            console.log(i);
            //iterate keys in object (f.e. company, from, to)
            obj = $("<div>").addClass("objectInArray");
            for(var j = 0 ; j < Object.keys( category[i] ).length ; j++){
                //console.log(Object.keys(category[i])[j]);
                line = $("<div>").addClass("line");
                key = $("<span>").addClass("key").text( Object.keys(category[i])[j] +": ");
                value = $("<span>").addClass("value").text( category[i][Object.keys(category[i])[j]]);
                line.append(key, value).appendTo(obj);	//
            }
            //append the X button
            obj.append($("<div>").addClass("delete").text("X"));
            obj.appendTo("#"+listToAppend);
        }

        $('.delete').on('click', function(){
            //console.log( $('.objectInArray').index($(this).parent()) );
			console.log(this);
            jsonProfile[$(this).parents("[data-json]").data("json")].splice($(this).parents(".objectInArray").index($(this).parent()), 1);
            $(this).parent().remove();
        });
    }
    //usage of function:
    updateObjectsInArray(jsonProfile.jobexperience, "jobexperiencelist");
    updateObjectsInArray(jsonProfile.schools, "schoolslist");




	$("#saveBtn").on("click", function(){
		jsonProfile.name = $("#name").val();
        jsonProfile.name2 = $("#name2").val();
        jsonProfile.age = $("#age").val();
        jsonProfile.tel = $("#tel").val();
        jsonProfile.address = $("#address").val();
        jsonProfile.jobexperience = $("#jobexperience").val().split(",");
        jsonProfile.schools = $("#schools").val().split(",");
        jsonProfile.skills = $("#skills").val().split(",");
        jsonProfile.intrests = $("#intrests").val().split(",");


	});

    //updateProfile(jsonProfile);
</script>
</html>