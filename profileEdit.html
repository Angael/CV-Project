<!DOCTYPE html>
<head>
	<html lang="pl">
	<meta charset="utf-8" />
	<link href="https://fonts.googleapis.com/css?family=Roboto+Slab" rel="stylesheet">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<link type="text/css" rel="stylesheet" href="style.css">
	<title>Profile Page</title>
</head>
<body>
<div id="wraphold">
	<div class="header">
		<div id="flex1">
			<div id="logo"></div>
			<form action>
			<div id="search-container" class="tile"  style="float:left;" >
			<input id="searchInput" onfocusout="BtnHide()" onfocus="BtnDisplay()" autocomplete="off"/>
			<div id="searchResults-container">
			</div>
			</div>
			<div id="flex2">
			<input type="button"/>
			<input type="button"/>
			<input type="button"/>
			
			<input id="Logout" value=""type="button"/>
	
	</div>
	</div><input id="searchBtn" type="button" value="Search"/><br>
				<div id="searchResults-container">
				</div>

				</div></form>
			</div>				
	<div class="centered">
		<h2>Edit Your Profile</h2>

		<div id="profile-container" class="tile" >
		<div class="section"><form>
		<table><tr><h3>Edit your name:</h3></tr>
			<tr><td>First Name: </td><td><input id="name"/><br></td></tr>
			<tr><td>Second Name: </td><td><input id="name2"/><br></td></tr>
			<tr><td></td><td><input type="button" onclick="addSimpleValues('name', jsonProfile.name);
addSimpleValues('name2', jsonProfile.name2);"  value="Save"></td></tr>
		</table></form>
		</div>
		<div class="section"><form>
		<table><tr><h3>Edit your password:</h3></tr>
			<tr><td>Current password: </td><td><input id="oldPass"/><br></td></tr>
			<tr><td>New password: </td><td><input id="newPass"/><br></td></tr>
			<tr><td>Repeat new password: </td><td><input id="newPassRepeat"/><br></td></tr>
			<tr><td></td><td><input type="button" value="Save"></td></tr>
		</table></form>
		</div>
		<div class="section"><form>
		<table><tr><h3>Edit your birth date:</h3></tr>
			<tr><td>Birth Date: </td><td><input id="dateofbirth"/><br></td></tr>
			<tr><td></td><td><input type="button" onclick="addSimpleValues('dateofbirth', jsonProfile.dateofbirth)" value="Save"></td></tr>
		</table></form>
		</div>
			<div class="section"><form>
				<table><tr><h3>Edit your interests:</h3></tr>
					<tr><td>Interests list (separated with comma ","): </td><td><input id="interests"/><br></td></tr>
					<tr><td></td><td><input type="button" onclick="addValuesToArray('interests', jsonProfile.interests)" value="Save"></td></tr>
				</table></form>
			</div>
		<div class="section"><form>
			<table><tr><h3>Edit your skills:</h3></tr>
				<tr><td>Skill list (separated with comma ","): </td><td><input id="skills"/><br></td></tr>
				<tr><td></td><td><input type="button" onclick="addValuesToArray('skills', jsonProfile.skills)" value="Save"></td></tr>
			</table></form>
		</div>
		<div class="section"><form>
		<table><tr><h3>Edit your address:</h3></tr>
			<tr><td>Adress: </td><td><input id="address"/><br></td></tr>
			<tr><td>Post-code and City :</td><td><input id="address2"/><br></td></tr>
			<tr><td>Country: </td><td><input id="country"/><br></td></tr>
			<tr><td></td><td><input type="button" onclick="addSimpleValues('address', jsonProfile.address);
addSimpleValues('address2', jsonProfile.address2);addSimpleValues('country', jsonProfile.country);" value="Save"></td></tr>
		</table></form>
		</div>

		<div class="section"><form id="jobexperienceform">
			<table><tr><h3>Add job experience:</h3></tr>

				<tr><td>Company name: </td><td><input name="company" id="companyName"/><br></td></tr>
				<tr><td>From date (dd-mm-yyyy):</td><td><input name="from" id="companyFrom"/><br></td></tr>
				<tr><td>To date (dd-mm-yyyy): </td><td><input name="to" id="companyTo"/><br></td></tr>
				<tr><td></td><td><input type="button" onclick="addObjectToArray('jobexperienceform',jsonProfile.jobexperience, 'jobexperiencelist')" value="+ Add"></td></tr>
			</table></form>
			<div id="jobexperiencelist" data-json="jobexperience"></div>
		</div>

			<div class="section"><form id="schoolsform">
				<table><tr><h3>Add finished school:</h3></tr>
					<tr><td>School name: </td><td><input name="name" id="schoolName"/><br></td></tr>
					<tr><td>From date (dd-mm-yyyy):</td><td><input name="from" id="schoolFrom"/><br></td></tr>
					<tr><td>To date (dd-mm-yyyy): </td><td><input name="to" id="schoolTo"/><br></td></tr>
					<tr><td></td><td><input type="button" onclick="addObjectToArray('schoolsform',jsonProfile.schools, 'schoolslist')" value="+ Add"></td></tr>
				</table></form>
				<div id="schoolslist" data-json="schools"></div>
			</div>

			<div class="section"><form id="projectsform">
				<table><tr><h3>Add finished projects:</h3></tr>
					<tr><td>Project name: </td><td><input name="name" id="projectName"/><br></td></tr>
					<tr><td>Ended (dd-mm-yyyy): </td><td><input name="ended" id="projectEnded"/><br></td></tr>
					<tr><td></td><td><input type="button" onclick="addObjectToArray('projectsform',jsonProfile.acomplishments.projects, 'projectslist')" value="+ Add"></td></tr>
				</table></form>
				<div id="projectslist" data-json="acomplishments.projects"></div>
			</div>

			<div class="section"><form id="coursesform">
				<table><tr><h3>Add finished courses:</h3></tr>
					<tr><td>Course name: </td><td><input name="name" id="courseName"/><br></td></tr>
					<tr><td>Ended (dd-mm-yyyy): </td><td><input name="ended" id="courseEnded"/><br></td></tr>
					<tr><td></td><td><input type="button" onclick="addObjectToArray('coursesform',jsonProfile.acomplishments.courses, 'courseslist')" value="+ Add"></td></tr>
				</table></form>
				<div id="courseslist" data-json="acomplishments.courses"></div>
			</div>

			<div class="section"><form id="certificatesform">
				<table><tr><h3>Add certificates:</h3></tr>
					<tr><td>Certificate name: </td><td><input name="name" id="certificateName"/><br></td></tr>
					<tr><td>Ended (dd-mm-yyyy): </td><td><input name="expirationDate" id="certificateEnded"/><br></td></tr>
					<tr><td></td><td><input type="button" onclick="addObjectToArray('certificatesform',jsonProfile.acomplishments.certificates, 'certificateslist')" value="+ Add"></td></tr>
				</table></form>
				<div id="certificateslist" data-json="acomplishments.certificates"></div>
			</div>

			<div class="section"><form id="languagesform">
				<table><tr><h3>Add your languages:</h3></tr>
					<tr><td>Language name: </td><td><input name="name" id="languagesName"/><br></td></tr>
					<tr><td>Proficiency: </td><td><input name="Proficiency" id="languagesEnded"/><br></td></tr>
					<tr><td></td><td><input type="button" onclick="addObjectToArray('languagesform',jsonProfile.acomplishments.languages, 'languageslist')" value="+ Add"></td></tr>
				</table></form>
				<div id="languageslist" data-json="acomplishments.languages"></div>
			</div>
			<!--<div class="section"><form id="jobexperienceform">-->
				<!--<table><tr><h3>Add job experience:</h3></tr>-->
					<!--<tr><td>Company name: </td><td><input name="company" id="companyName"/><br></td></tr>-->
					<!--<tr><td>From date (dd-mm-yyyy):</td><td><input name="from" id="companyFrom"/><br></td></tr>-->
					<!--<tr><td>To date (dd-mm-yyyy): </td><td><input name="to" id="companyTo"/><br></td></tr>-->
					<!--<tr><td></td><td><input type="button" onclick="addObjectToArray('jobexperienceform',jsonProfile.jobexperience, 'jobexperiencelist')" value="+ Add"></td></tr>-->
				<!--</table></form>-->
				<!--<div id="jobexperiencelist" data-json="jobexperience"></div>-->
			<!--</div>-->
		<!--
		<div class="section"><form>
		<table>
			<tr><td>First Name: </td><td><input id="name"/><br></td></tr>
			<tr><td>Second Name: </td><td><input id="name2"/><br></td></tr>
			<tr><td></td><td><input type="submit"></td></tr>
		</table></form>
		</div>
			<tr><td>Age: </td><td><input id="age"/><br></td></tr>
			<tr><td>Tel: </td><td><input id="tel"/><br></td></tr>
			<tr><td>Address: </td><td><input id="address"/><br></td></tr>
			<tr><td>Job Experience: </td><td><input id="jobexperience"/><br></td></tr>
			<tr><td>Schools: </td><td><input id="schools"/><br></td></tr>
			<tr><td>Skills: </td><td><input id="skills"/><br></td></tr>
			<tr><td>Intrests: </td><td><input id="intrests"/><br></td></tr>
			<tr><td>Languages: </td><td><input id="languages" disabled/><br></td></tr>
			<tr><input id="saveBtn" type="button" value="Save"/></td></tr>
		</table>-->

		</div>
		
		</form>
	</div>
	</div>
	<div class="footer"></div>
	</div>
</body>

<script>
    //TODO: Group this code with other code, For now it is here for clarity purposes
    //List capability script
    //TMP command: $("<div>").html( $("<div>").html("hehe") ).appendTo(".objectInArray")

    var jsonProfile = {
        "uid":2,
        "name": "Krzysztof",
        "name2": "Widacki",
        "dateofbirth": "19-04-1998",
        "birthofaccount":"21-04-1998",
        "email": "krzysztofwidacki@gmail.com",
        "tel": "123456789",
        "address": "Słoneczna 15",
        "address2": "Warsaw 02-540",
        "country":"Poland",
        "jobexperience": [
            {"company":"Acaisoft",
                "from":"12-12-2017",
                "to":"1-1-2018"
            },
            {"company":"Google",
                "from":"12-12-2017",
                "to":"1-1-2018"
            },
            {"company":"Microsoft",
                "from":"12-12-2017",
                "to":"1-1-2018"
            }
        ],
        "schools": [
            {"name":"Wiśniowa",
                "from":"1-12-1212",
                "to":"2-12-1212"},
            {"name":"Staffa nr 1",
                "from":"1-12-1212",
                "to":"2-12-1212"},
            {"name":"Generic School 3",
                "from":"2-11-1318",
                "to":"2-1-1290"}
        ],
        "skills": [
            "breathing", "holding two handed swords with one hand"
        ],
        "interests": [
            "Films", "Bikes"
        ],
        "acomplishments":{
            "projects":[
                {
                    "name":"google self driving cars",
                    "ended":"1-1-2012"
                },
                {
                    "name":"cloudlanes",
                    "ended":"3-2-2013"
                }
            ],
            "courses":[
                {
                    "name":"ccna1course",
                    "ended":"1-1-2017"
                },
                {
                    "name":"ccna2course",
                    "ended":"2-2-2017"
                }
            ],
            "certificates":[
                {
                    "name":"ccna1",
                    "expirationDate":"1-1-2017"
                },
                {
                    "name":"ccna2",
                    "expirationDate":"2-2-2017"
                }
            ],
            "languages": [{
                "language": "english",
                "proficiency": "master"
            },
                {
                    "language": "german",
                    "proficiency": "beginner"
                }
            ]
        },
        "friends":[{
            "uid":1,
            "name": "Paweł",
            "name2": "Kłos"
        },
            {
                "uid":3,
                "name": "Wojciech",
                "name2": "Cejerowski"
            }]
    };
var password ={
    'oldPass' : "Start123"
}

	function changePassword(oldPass, newPass, newPassRepeat){
    //query to Database
    	if($("#"+newPass).val()){ //old password typed correctly
    	    if($("#"+newPass).val() === $("#"+newPassRepeat).val()){ ///both same passwords


			}
		}else{

		}
	}

    function addObjectToArray(form, category, listToAppend){
        var fields = {};
        $("#"+form).find("input:not([type=button])").each(function() {
            fields[this.name] = $(this).val();
        });
        category.unshift(fields);
        updateObjectsInArray(category, listToAppend);
    }
    function addValuesToArray(input, category){
        var field = $("#"+input);
        category = field.val().split(",");
        updateValuesInForms(input, category);
    }
    function addSimpleValues(input, category){
        var field = $("#"+input);
        jsonProfile[input] = field.val();
        updateSimpleValuesInForms(input, jsonProfile[input]);
    }
    function updateSimpleValuesInForms(input, category){
        var field = $("#"+input);
        console.log(category);
        field.val(category);
	}
    function updateValuesInForms(input, category){
        var field = $("#"+input);
        console.log(category);
        field.val(category.join(","));
	}
    function updateObjectsInArray(category, listToAppend){
        var obj;
        var line;
        var key;
        var value;
        //iterate different objects in array of f.e jobexperience
        $("#"+listToAppend).empty();
        for(var i = 0 ; i < category.length ; i++){
            console.log(i);
            //iterate keys in object (f.e. company, from, to)
            obj = $("<div>").addClass("objectInArray");
            for(var j = 0 ; j < Object.keys( category[i] ).length ; j++){
                //console.log(Object.keys(category[i])[j]);
                line = $("<div>").addClass("line");
                key = $("<span>").addClass("key").text( Object.keys(category[i])[j] +": ");
                value = $("<span>").addClass("value").text( category[i][Object.keys(category[i])[j]]);
                line.append(key, value).appendTo(obj);	//
            }
            //append the X button
            obj.append($("<div>").addClass("delete").text("X"));
            obj.appendTo("#"+listToAppend);
        }

        $('#'+listToAppend+' .delete').on('click', function(){
            //console.log( $('.objectInArray').index($(this).parent()) );
			console.log(this);
			var datajson = $(this).parents("[data-json]").data("json");
            if (datajson.indexOf('.') > -1)
            {
                jsonProfile[datajson.substring(0, datajson.indexOf("."))][datajson.substring(datajson.indexOf('.')+1, datajson.length)].splice($(this).parents(".objectInArray").index($(this).parent()), 1);
            }else{
                jsonProfile[datajson].splice($(this).parents(".objectInArray").index($(this).parent()), 1);
			}

            $(this).parent().remove();
        });
    }
    //Update existing data in jsonProfile:
    updateValuesInForms('skills', jsonProfile.skills);
    updateValuesInForms('interests', jsonProfile.interests);
    updateObjectsInArray(jsonProfile.jobexperience, "jobexperiencelist");
    updateObjectsInArray(jsonProfile.schools, "schoolslist");
    updateObjectsInArray(jsonProfile.acomplishments.projects, "projectslist");
    updateObjectsInArray(jsonProfile.acomplishments.courses, "courseslist");
    updateObjectsInArray(jsonProfile.acomplishments.certificates, "certificateslist");
    updateObjectsInArray(jsonProfile.acomplishments.languages, "languageslist");
/*
	$("#saveBtn").on("click", function(){
		jsonProfile.name = $("#name").val();
        jsonProfile.name2 = $("#name2").val();
        jsonProfile.age = $("#age").val();
        jsonProfile.tel = $("#tel").val();
        jsonProfile.address = $("#address").val();
        jsonProfile.jobexperience = $("#jobexperience").val().split(",");
        jsonProfile.schools = $("#schools").val().split(",");
        jsonProfile.skills = $("#skills").val().split(",");
        jsonProfile.intrests = $("#intrests").val().split(",");



	});
	
	function BtnDisplay(){
	document.getElementById("searchBtn").style.display="block";}
	function BtnHide(){
	document.getElementById("searchBtn").style.display="none";}

    updateProfile(jsonProfile);
	
	 /*var settings = {

        "crossDomain": true,
        "url": "https://reqres.in/api/users/3",
        "method": "GET",
        "headers": {
            "cache-control": "no-cache",
            "postman-token": "0554329c-c2fa-1524-9653-fc44f2a7c20c"
        }
    }

    $.ajax(settings).done(function (response) {
        console.log(response);
    });*/

    var allUsers = [{
        "uid":2,
        "name": "Krzysztof",
        "name2": "Widacki",
        "email": "krzysztofwidacki@gmail.com",

    },{
        "uid":1,
        "name": "Paweł",
        "name2": "Kłos",
        "email": "98asdjwofapixjc@gmail.com",

    },{
        "uid":3,
        "name": "Wojciech",
        "name2": "Cejerowski",
        "email": "someCejerowski@gmail.com",

    },{
        "uid":4,
        "name": "Krzysztof",
        "name2": "Orecki",
        "email": "some@gmail.com",

    },
	];
    //var result = $.grep(allUsers, function(e){ return e.name == "Krzysztof"; });
    function searchUser(value){
        var result = $.grep(allUsers, function(e){
            var isFound = ((e.name.toLowerCase() +" "+ e.name2.toLowerCase() + " " + e.email.toLowerCase()).match(new RegExp(value, 'gi')));
            return isFound;
        });
		//console.log(result);
		var list ="";
        result.forEach(function(val){
            list += "<a href='user/" + val.uid + "'>" + val.name +" "+ val.name2 + "</a>";

		});
        $("#searchResults-container").html(list);

	}



	$("#searchBtn").on("click", function(){
        //console.log(result);
        searchUser($("#searchInput").val());
	});
    $("#searchInput").on("keyup", function(){
        //console.log(result);
        searchUser($("#searchInput").val());
    });
</script>
</html>